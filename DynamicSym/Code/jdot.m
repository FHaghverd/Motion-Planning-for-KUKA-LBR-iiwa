function [Jdot] = jdot
syms q1 q2 q3 q4 q5 q6 q7
syms dq1 dq2 dq3 dq4 dq5 dq6 dq7
q=[q1;q2;q3;q4;q5;q6;q7];
dq=[dq1;dq2;dq3;dq4;dq5;dq6;dq7];
d3=0.4;
d5=0.39;
d0=0.31;
d7=0.078;
f=sym([pi/2;-pi/2;-pi/2;pi/2;pi/2;-pi/2;0]);
a=[0;0;0;0;0;0;0];
d=[0;0;d3;0;d5;0;0];
t=[q1;q2;q3;q4;q5;q6;q7];
%Transformation matrix i about i-1
A0=[1 0 0 0;0 1 0 0;0 0 1 d0;0 0 0 1];  
A1=[cos(t(1,1)) -sin(t(1,1))*cos(f(1,1)) sin(t(1,1))*sin(f(1,1)) a(1,1)*cos(t(1,1));sin(t(1,1)) cos(t(1,1))*cos(f(1,1)) -cos(t(1 ,1))*sin(f(1,1)) a(1,1)*sin(t(1,1));0 sin(f(1,1)) cos(f(1,1)) d(1,1);0 0 0 1];
A2=[cos(t(2,1)) -sin(t(2,1))*cos(f(2,1)) sin(t(2,1))*sin(f(2,1)) a(2,1)*cos(t(2,1));sin(t(2,1)) cos(t(2,1))*cos(f(2,1)) -cos(t(2 ,1))*sin(f(2,1)) a(2,1)*sin(t(2,1));0 sin(f(2,1)) cos(f(2,1)) d(2,1);0 0 0 1];
A3=[cos(t(3,1)) -sin(t(3,1))*cos(f(3,1)) sin(t(3,1))*sin(f(3,1)) a(3,1)*cos(t(3,1));sin(t(3,1)) cos(t(3,1))*cos(f(3,1)) -cos(t(3 ,1))*sin(f(3,1)) a(3,1)*sin(t(3,1));0 sin(f(3,1)) cos(f(3,1)) d(3,1);0 0 0 1];
A4=[cos(t(4,1)) -sin(t(4,1))*cos(f(4,1)) sin(t(4,1))*sin(f(4,1)) a(4,1)*cos(t(4,1));sin(t(4,1)) cos(t(4,1))*cos(f(4,1)) -cos(t(4 ,1))*sin(f(4,1)) a(4,1)*sin(t(4,1));0 sin(f(4,1)) cos(f(4,1)) d(4,1);0 0 0 1];
A5=[cos(t(5,1)) -sin(t(5,1))*cos(f(5,1)) sin(t(5,1))*sin(f(5,1)) a(5,1)*cos(t(5,1));sin(t(5,1)) cos(t(5,1))*cos(f(5,1)) -cos(t(5 ,1))*sin(f(5,1)) a(5,1)*sin(t(5,1));0 sin(f(5,1)) cos(f(5,1)) d(5,1);0 0 0 1];
A6=[cos(t(6,1)) -sin(t(6,1))*cos(f(6,1)) sin(t(6,1))*sin(f(6,1)) a(6,1)*cos(t(6,1));sin(t(6,1)) cos(t(6,1))*cos(f(6,1)) -cos(t(6 ,1))*sin(f(6,1)) a(6,1)*sin(t(6,1));0 sin(f(6,1)) cos(f(6,1)) d(6,1);0 0 0 1];
A7=[cos(t(7,1)) -sin(t(7,1))*cos(f(7,1)) sin(t(7,1))*sin(f(7,1)) a(7,1)*cos(t(7,1));sin(t(7,1)) cos(t(7,1))*cos(f(7,1)) -cos(t(7 ,1))*sin(f(7,1)) a(7,1)*sin(t(7,1));0 sin(f(7,1)) cos(f(7,1)) d(7,1);0 0 0 1];
Ae=[1 0 0 0;0 1 0 0;0 0 1 d7;0 0 0 1];
%Transformation matrix i about 0
T1=A0*A1;
T2=A0*A1*A2;
T3=A0*A1*A2*A3;
T4=A0*A1*A2*A3*A4;
T5=A0*A1*A2*A3*A4*A5;
T6=A0*A1*A2*A3*A4*A5*A6;
Te=A0*A1*A2*A3*A4*A5*A6*A7*Ae;
% %Rotation matrix i about 0
% R0=eye(3);
% R1=T1(1:3,1:3);
% R2=T2(1:3,1:3);
% R3=T3(1:3,1:3);
% R4=T4(1:3,1:3);
% R5=T5(1:3,1:3);
% R6=T6(1:3,1:3);
% R7=Te(1:3,1:3);
%jacobian matrix
z0=[0;0;1];
z1=T1(1:3,3);
z2=T2(1:3,3);
z3=T3(1:3,3);
z4=T4(1:3,3);
z5=T5(1:3,3);
z6=T6(1:3,3);
% z7=Te(1:3,3);
p0=[0;0;0];
p1=T1(1:3,4);
p2=T2(1:3,4);
p3=T3(1:3,4);
p4=T4(1:3,4);
p5=T5(1:3,4);
p6=T6(1:3,4);
pe=Te(1:3,4);
J=[cross(z0,(pe-p0)) cross(z1,(pe-p1)) cross(z2,(pe-p2)) cross(z3,(pe-p3)) cross(z4,(pe-p4)) cross(z5,(pe-p5)) cross(z6,(pe-p6));z0 z1 z2 z3 z4 z5 z6]; %jacobian matrix of end_effector
% jacobian diff about time
Jdot=zeros(7);
Jdot=Jdot(1:6,:);
matrix_1=jacobian(J(1,:),q);
Jdot(1,1)=matrix_1(1,:)*dq;
Jdot(1,2)=matrix_1(2,:)*dq;
Jdot(1,3)=matrix_1(3,:)*dq;
Jdot(1,4)=matrix_1(4,:)*dq;
Jdot(1,5)=matrix_1(5,:)*dq;
Jdot(1,6)=matrix_1(6,:)*dq;
Jdot(1,7)=matrix_1(7,:)*dq;
matrix_2=jacobian(J(2,:),q);
Jdot(2,1)=matrix_2(1,:)*dq;
Jdot(2,2)=matrix_2(2,:)*dq;
Jdot(2,3)=matrix_2(3,:)*dq;
Jdot(2,4)=matrix_2(4,:)*dq;
Jdot(2,5)=matrix_2(5,:)*dq;
Jdot(2,6)=matrix_2(6,:)*dq;
Jdot(2,7)=matrix_2(7,:)*dq;
matrix_3=jacobian(J(3,:),q);
Jdot(3,1)=matrix_3(1,:)*dq;
Jdot(3,2)=matrix_3(2,:)*dq;
Jdot(3,3)=matrix_3(3,:)*dq;
Jdot(3,4)=matrix_3(4,:)*dq;
Jdot(3,5)=matrix_3(5,:)*dq;
Jdot(3,6)=matrix_3(6,:)*dq;
Jdot(3,7)=matrix_3(7,:)*dq;
matrix_4=jacobian(J(4,:),q);
Jdot(4,1)=matrix_4(1,:)*dq;
Jdot(4,2)=matrix_4(2,:)*dq;
Jdot(4,3)=matrix_4(3,:)*dq;
Jdot(4,4)=matrix_4(4,:)*dq;
Jdot(4,5)=matrix_4(5,:)*dq;
Jdot(4,6)=matrix_4(6,:)*dq;
Jdot(4,7)=matrix_4(7,:)*dq;
matrix_5=jacobian(J(5,:),q);
Jdot(5,1)=matrix_5(1,:)*dq;
Jdot(5,2)=matrix_5(2,:)*dq;
Jdot(5,3)=matrix_5(3,:)*dq;
Jdot(5,4)=matrix_5(4,:)*dq;
Jdot(5,5)=matrix_5(5,:)*dq;
Jdot(5,6)=matrix_5(6,:)*dq;
Jdot(5,7)=matrix_5(7,:)*dq;
matrix_6=jacobian(J(6,:),q);
Jdot(6,1)=matrix_6(1,:)*dq;
Jdot(6,2)=matrix_6(2,:)*dq;
Jdot(6,3)=matrix_6(3,:)*dq;
Jdot(6,4)=matrix_6(4,:)*dq;
Jdot(6,5)=matrix_6(5,:)*dq;
Jdot(6,6)=matrix_6(6,:)*dq;
Jdot(6,7)=matrix_6(7,:)*dq;
end

